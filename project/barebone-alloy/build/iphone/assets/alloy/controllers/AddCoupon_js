function __processArg(e,t){var o=null;return e&&(o=e[t]||null,delete e[t]),o}function Controller(){require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="AddCoupon",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var e=this,t={};e.__views.winAddCoupon=Ti.UI.createWindow({id:"winAddCoupon",title:"Add Coupon"}),e.__views.winAddCoupon&&e.addTopLevelView(e.__views.winAddCoupon);var o=[];e.__views.__alloyId1=Ti.UI.createTableViewRow({height:"auto",selectionStyle:"none",id:"__alloyId1"}),o.push(e.__views.__alloyId1),e.__views.nameField=Ti.UI.createTextField({autocapitalization:!1,color:Alloy.Globals.ThemeStyles.textfield.color,height:Alloy.Globals.ThemeStyles.textfield.height,top:Alloy.Globals.ThemeStyles.button.padding,left:Alloy.Globals.ThemeStyles.button.padding,right:Alloy.Globals.ThemeStyles.button.padding,width:Ti.UI.FILL,font:Alloy.Globals.ThemeStyles.textfield.font,paddingLeft:Alloy.Globals.ThemeStyles.button.padding,borderColor:Alloy.Globals.ThemeStyles.textfield.borderColor,borderStyle:Alloy.Globals.ThemeStyles.textfield.borderStyle,borderRadius:Alloy.Globals.ThemeStyles.textfield.borderRadius,id:"nameField",hintText:"Enter Name"}),e.__views.__alloyId1.add(e.__views.nameField),e.__views.__alloyId2=Ti.UI.createTableViewRow({height:"auto",selectionStyle:"none",id:"__alloyId2"}),o.push(e.__views.__alloyId2),e.__views.locationField=Ti.UI.createTextField({autocapitalization:!1,color:Alloy.Globals.ThemeStyles.textfield.color,height:Alloy.Globals.ThemeStyles.textfield.height,top:Alloy.Globals.ThemeStyles.button.padding,left:Alloy.Globals.ThemeStyles.button.padding,right:Alloy.Globals.ThemeStyles.button.padding,width:Ti.UI.FILL,font:Alloy.Globals.ThemeStyles.textfield.font,paddingLeft:Alloy.Globals.ThemeStyles.button.padding,borderColor:Alloy.Globals.ThemeStyles.textfield.borderColor,borderStyle:Alloy.Globals.ThemeStyles.textfield.borderStyle,borderRadius:Alloy.Globals.ThemeStyles.textfield.borderRadius,id:"locationField",hintText:"Location"}),e.__views.__alloyId2.add(e.__views.locationField),e.__views.__alloyId3=Ti.UI.createTableViewRow({height:"auto",selectionStyle:"none",id:"__alloyId3"}),o.push(e.__views.__alloyId3),e.__views.titleField=Ti.UI.createTextField({autocapitalization:!1,color:Alloy.Globals.ThemeStyles.textfield.color,height:Alloy.Globals.ThemeStyles.textfield.height,top:Alloy.Globals.ThemeStyles.button.padding,left:Alloy.Globals.ThemeStyles.button.padding,right:Alloy.Globals.ThemeStyles.button.padding,width:Ti.UI.FILL,font:Alloy.Globals.ThemeStyles.textfield.font,paddingLeft:Alloy.Globals.ThemeStyles.button.padding,borderColor:Alloy.Globals.ThemeStyles.textfield.borderColor,borderStyle:Alloy.Globals.ThemeStyles.textfield.borderStyle,borderRadius:Alloy.Globals.ThemeStyles.textfield.borderRadius,id:"titleField",hintText:"Title"}),e.__views.__alloyId3.add(e.__views.titleField),e.__views.__alloyId4=Ti.UI.createTableViewRow({height:"auto",selectionStyle:"none",id:"__alloyId4"}),o.push(e.__views.__alloyId4),e.__views.bodyField=Ti.UI.createTextField({autocapitalization:!1,color:Alloy.Globals.ThemeStyles.textfield.color,height:Alloy.Globals.ThemeStyles.textfield.height,top:Alloy.Globals.ThemeStyles.button.padding,left:Alloy.Globals.ThemeStyles.button.padding,right:Alloy.Globals.ThemeStyles.button.padding,width:Ti.UI.FILL,font:Alloy.Globals.ThemeStyles.textfield.font,paddingLeft:Alloy.Globals.ThemeStyles.button.padding,borderColor:Alloy.Globals.ThemeStyles.textfield.borderColor,borderStyle:Alloy.Globals.ThemeStyles.textfield.borderStyle,borderRadius:Alloy.Globals.ThemeStyles.textfield.borderRadius,id:"bodyField",hintText:"Body"}),e.__views.__alloyId4.add(e.__views.bodyField),e.__views.row=Ti.UI.createTableViewRow({id:"row"}),o.push(e.__views.row),e.__views.btnAddCoupon=Ti.UI.createView({top:Alloy.Globals.ThemeStyles.button.padding,left:Alloy.Globals.ThemeStyles.button.padding,right:Alloy.Globals.ThemeStyles.button.padding,width:Ti.UI.FILL,height:Alloy.Globals.ThemeStyles.buttonPurple.height,color:Alloy.Globals.ThemeStyles.buttonPurple.color,backgroundColor:Alloy.Globals.ThemeStyles.buttonPurple.backgroundColor,borderColor:Alloy.Globals.ThemeStyles.buttonPurple.borderColor,borderStyle:Alloy.Globals.ThemeStyles.buttonPurple.borderStyle,borderRadius:Alloy.Globals.ThemeStyles.buttonPurple.borderRadius,borderWidth:Alloy.Globals.ThemeStyles.buttonPurple.borderWidth,font:Alloy.Globals.ThemeStyles.buttonPurple.font,id:"btnAddCoupon"}),e.__views.row.add(e.__views.btnAddCoupon),e.__views.__alloyId5=Ti.UI.createLabel({textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,verticalAlign:Ti.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,color:Alloy.Globals.ThemeStyles.button.color,font:Alloy.Globals.ThemeStyles.button.font,width:"auto",height:"auto",touchEnabled:!1,text:"Add Coupon",id:"__alloyId5"}),e.__views.btnAddCoupon.add(e.__views.__alloyId5),e.__views.row=Ti.UI.createTableViewRow({id:"row"}),o.push(e.__views.row),e.__views.btnRemoveCoupon=Ti.UI.createView({top:Alloy.Globals.ThemeStyles.button.padding,left:Alloy.Globals.ThemeStyles.button.padding,right:Alloy.Globals.ThemeStyles.button.padding,width:Ti.UI.FILL,height:Alloy.Globals.ThemeStyles.buttonPurple.height,color:Alloy.Globals.ThemeStyles.buttonPurple.color,backgroundColor:Alloy.Globals.ThemeStyles.buttonPurple.backgroundColor,borderColor:Alloy.Globals.ThemeStyles.buttonPurple.borderColor,borderStyle:Alloy.Globals.ThemeStyles.buttonPurple.borderStyle,borderRadius:Alloy.Globals.ThemeStyles.buttonPurple.borderRadius,borderWidth:Alloy.Globals.ThemeStyles.buttonPurple.borderWidth,font:Alloy.Globals.ThemeStyles.buttonPurple.font,id:"btnRemoveCoupon"}),e.__views.row.add(e.__views.btnRemoveCoupon),e.__views.__alloyId6=Ti.UI.createLabel({textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,verticalAlign:Ti.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,color:Alloy.Globals.ThemeStyles.button.color,font:Alloy.Globals.ThemeStyles.button.font,width:"auto",height:"auto",touchEnabled:!1,text:"Remove Coupon",id:"__alloyId6"}),e.__views.btnRemoveCoupon.add(e.__views.__alloyId6),e.__views.locationForm=Ti.UI.createTableView({data:o,id:"locationForm"}),e.__views.winAddCoupon.add(e.__views.locationForm),t.destroy=function(){},_.extend(e,e.__views);var l=arguments[0]||{},i=function(){UTL.ShowPage("MerchantLocations",{callback:function(t){e.locationField.value=t.name,e.locationField.locationid=t.id}})};e.locationField.addEventListener("focus",i),e.locationField.addEventListener("touchstart",i),e.winAddCoupon.addEventListener("open",function(){API.GetMerchantLocations(function(t){for(var o=[],l=0;l<t.length;++l){var i=t[l];o.push(Ti.UI.createPickerRow({title:i.name}))}e.locationField.add(o)})}),e.btnRemoveCoupon.addEventListener("click",function(){API.DeleteCoupon(l.edit.id,function(){alert("Coupon removed!"),UTL.ShowPage("MerchantCoupons"),e.winAddCoupon.close()})}),e.btnAddCoupon.addEventListener("click",function(){l.edit?API.EditCoupon(l.edit.id,{name:e.nameField.value,title:e.titleField.value,body:e.bodyField.value,location:e.locationField.locationid},function(){alert("Coupon edited!"),UTL.ShowPage("MerchantCoupons"),e.winAddCoupon.close()}):API.NewCoupon({name:e.nameField.value,title:e.titleField.value,body:e.bodyField.value,location:e.locationField.locationid},function(){alert("Coupon added!"),e.winAddCoupon.close(),UTL.ShowPage("MerchantCoupons")})}),l.edit&&(API.GetMerchantLocations(function(t){for(var o={},i=0;i<t.length;++i)o[t[i].id]=t[i];e.nameField.value=l.edit.name,e.titleField.value=l.edit.title,e.bodyField.value=l.edit.body,e.locationField.locationid=l.edit.location,e.locationField.value=o[l.edit.location].name}),e.btnAddCoupon.children[0].text="Edit Coupon"),e.btnRemoveCoupon.visible=null!=l.edit,_.extend(e,t)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;