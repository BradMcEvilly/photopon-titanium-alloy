function __processArg(e,t){var o=null;return e&&(o=e[t]||null,delete e[t]),o}function Controller(){function e(){l.ind.show(),Alloy.Globals.latitude?t():(console.log("Waiting for geo information"),setTimeout(e,5e3))}function t(){return Titanium.Network.online?void API.GetCouponsByLocation({latitude:Alloy.Globals.latitude,longitude:Alloy.Globals.longitude},function(e){console.log("API.GetCouponsByLocation callback"),console.log(e);for(var t=[],o=0;o<e.length;o++)t.push(Alloy.createController("CouponsRow",{CouponsItem:e[o]}).getView());l.photoponCouponsTable.setData(t),Alloy.Globals.CachedCoupons=e,l.ind.hide()},function(){l.ind.hide(),alert("Check connection - Unknow error from api")}):void alert("Poor internet connection")}function o(e){if("GET"==e.source.clickName){var t=Alloy.createController("SnapWrapWebView",{CouponsItem:e.row.CouponsItem}).getView();Alloy.Globals.navGroup.openWindow(t)}else"GIVE"==e.source.clickName&&(console.log(e.row),UTL.ShowPage("PhotoponCamera",{coupon:e.row.CouponsItem}))}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="PhotoponCoupons",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var l=this,i={};l.__views.winPhotoponCoupons=Ti.UI.createWindow({backgroundColor:Alloy.Globals.ThemeStyles.win.backgroundColor,title:"Coupons",navTintColor:Alloy.Globals.ThemeStyles.win.navTintColor,barColor:Alloy.Globals.ThemeStyles.win.barColor,translucent:!1,id:"winPhotoponCoupons"}),l.__views.winPhotoponCoupons&&l.addTopLevelView(l.__views.winPhotoponCoupons),l.__views.photoponCouponsTable=Ti.UI.createTableView({showVerticalScrollIndicator:!1,height:"auto",backgroundColor:"transparent",separatorColor:"transparent",id:"photoponCouponsTable"}),l.__views.winPhotoponCoupons.add(l.__views.photoponCouponsTable),l.__views.ind=Ti.UI.createActivityIndicator({indicatorDiameter:160,indicatorColor:Alloy.Globals.ThemeColors.black,color:Alloy.Globals.ThemeColors.black,id:"ind"}),l.__views.winPhotoponCoupons.add(l.__views.ind),i.destroy=function(){},_.extend(l,l.__views),l.winPhotoponCoupons.addEventListener("open",function(){Titanium.Geolocation.locationServicesEnabled?e():alert("You should have geolocation enabled to see coupons.")}),l.photoponCouponsTable.addEventListener("click",function(e){var t=e.source.clickName;if(t)o(e);else{var l=Alloy.createController("CouponsDetail",{CouponsItem:e.row.CouponsItem}).getView();Alloy.Globals.navGroup.openWindow(l)}}),_.extend(l,i)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;