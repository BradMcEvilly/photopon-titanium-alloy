function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}function InitAdapter(){throw"localStorage persistence supported only with MobileWeb."}function Sync(e,l,o){function t(e){localStorage.setItem(r,JSON.stringify(e))}var r=l.config.adapter.collection_name,i=l.config.data,a=null;switch(e){case"create":l.id||(l.id=guid(),l.set(l.idAttribute,l.id)),i[l.id]=l,t(i),a=l.toJSON();break;case"read":var s=localStorage.getItem(r),n=s&&JSON.parse(s)||{},d=0;for(var y in n){var b=new l.config.Model(n[y]);l.models.push(b),d++}l.length=d,a=1===d?l.models[0]:l.models;break;case"update":i[l.id]=l,t(i),a=l.toJSON();break;case"delete":delete i[l.id],t(i),a=l.toJSON()}a?(_.isFunction(o.success)&&o.success(a),"read"===e&&l.trigger("fetch")):_.isFunction(o.error)&&o.error(a)}var _=require("alloy/underscore")._;module.exports.sync=Sync,module.exports.beforeModelCreate=function(e){return e=e||{},e.data={},InitAdapter(),e},module.exports.afterModelCreate=function(e){return e=e||{},e.prototype.config.Model=e,e};